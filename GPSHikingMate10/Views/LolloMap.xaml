<ctl:OpObsOrControl
	x:Class="LolloGPS.Core.LolloMap"
	x:Name="me"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:ctl="using:LolloBaseUserControls"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:local="using:LolloGPS.Core"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	mc:Ignorable="d"
	xmlns:Maps="using:Windows.UI.Xaml.Controls.Maps" 
	UseLayoutRounding="True"
	d:DesignHeight="400"
	d:DesignWidth="500"
	DataContext="{Binding MyPersistentData, RelativeSource={RelativeSource Self}}">
	<UserControl.Resources>
		<local:HeadingConverter x:Key="HeadingConverter"/>
		<local:ScaleSizeConverter x:Key="ScaleSizeConverter"/>
		<x:Double x:Key="LeftMargin4Scale">20</x:Double>
		<!--<CollectionViewSource x:Name="LocationList"/>-->
		<!--<DataTemplate x:Key="LandmarksTemplate">
			--><!-- LOLLO NOTE NormalizedAnchorPoint does not work, neither so, nor with the binding -->
			<!--Maps:MapControl.NormalizedAnchorPoint=".5,.5"-->
			<!--<Image Source="ms-appx:///Assets/pointer_landmark-20.png"
				   Stretch="None"
				   Maps:MapControl.Location="{Binding}"
				   Maps:MapControl.NormalizedAnchorPoint="{Binding ElementName=me, Path=LandmarksNormalisedIconPoint}"
				   IsTapEnabled="False" IsHoldingEnabled="False" 
				IsHitTestVisible="False" 
				IsDoubleTapEnabled="False" IsRightTapEnabled="False"
				AutomationProperties.AccessibilityView="Raw"/>--><!--
			<Path Width="20" Height="20" 
				Stretch="None" 
				Stroke="{StaticResource LandmarksBrushOpaque}"
				StrokeThickness="2"
				Data="M -10,-10 L 10,10 M 10,-10 L -10,10"
				Maps:MapControl.Location="{Binding}"
				IsTapEnabled="False" IsHoldingEnabled="False" 
				IsHitTestVisible="False" 
				IsDoubleTapEnabled="False" IsRightTapEnabled="False"
				AutomationProperties.AccessibilityView="Raw"/>
		</DataTemplate>-->
	</UserControl.Resources>
	<Grid x:Name="RootGrid">
		<!-- test -->
		<!--<Canvas Canvas.ZIndex="999">
			--><!--Data="F1 M 36.4167,19C 44.2867,19 50.6667,24.6711 50.6667,31.6667C 50.6667,32.7601 50.5108,33.8212 50.2177,34.8333L 36.4167,57L 22.6156,34.8333C 22.3225,33.8212 22.1667,32.7601 22.1667,31.6667C 22.1667,24.6711 28.5466,19 36.4167,19 Z M 36.4167,27.7083C 34.2305,27.7083 32.4583,29.4805 32.4583,31.6667C 32.4583,33.8528 34.2305,35.625 36.4167,35.625C 38.6028,35.625 40.375,33.8528 40.375,31.6667C 40.375,29.4805 38.6028,27.7083 36.4167,27.7083 Z "/>--><!--
			<Path Canvas.Left="0" Canvas.Top="200" Canvas.ZIndex="999"
			  Stretch="None" 
			  Stroke="{StaticResource LandmarksBrushOpaque}"
			  StrokeThickness="2"
			  Data="M 0,0 L 19,19 M 19,0 L 0,19"/>
		</Canvas>-->
		<!-- point details -->
		<Popup x:Name="SelectedPointPopup" IsLightDismissEnabled="True" Closed="OnInfoPanelClosed"
			ScrollViewer.HorizontalScrollBarVisibility="Visible" ScrollViewer.VerticalScrollBarVisibility="Visible">
			<local:PointInfoPanel DataContext="{Binding}" x:Name="MyPointInfoPanel"
				PointChanged="OnInfoPanelPointChanged"/>
			<!--PopupContainer="{x:Bind Path=RootGrid}"/>-->
		</Popup>
		<!--compass-->
		<Canvas Canvas.ZIndex="200"
				IsDoubleTapEnabled="False" IsHitTestVisible="False" IsHoldingEnabled="False" IsRightTapEnabled="False"
				VerticalAlignment="Top" HorizontalAlignment="Left">
			<Image Canvas.Top="120" Canvas.Left="30"
				 IsDoubleTapEnabled="False" IsHitTestVisible="False" IsHoldingEnabled="False" IsRightTapEnabled="False"
				 RenderTransformOrigin="0.5,0.5" Source="ms-appx:///Assets/compass-50.png" Stretch="None" HorizontalAlignment="Center">
				<Image.RenderTransform>
					<CompositeTransform Rotation="{Binding ElementName=MyMap, Path=Heading, Converter={StaticResource HeadingConverter}}"/>
				</Image.RenderTransform>
			</Image>
		</Canvas>
		<!--speedometer-->
		<Canvas Canvas.ZIndex="200" 
				IsDoubleTapEnabled="False" IsHitTestVisible="False" IsHoldingEnabled="False" IsRightTapEnabled="False"
				VerticalAlignment="Top" HorizontalAlignment="Right">
			<StackPanel Orientation="Horizontal" Canvas.Left="-230" Canvas.Top="150" 
				HorizontalAlignment="Left"
				Visibility="{Binding IsShowSpeed, Converter={StaticResource BooleanToVisibleConverter}}">
				<TextBlock Text="{Binding Current.SpeedInMetreSec, Converter={StaticResource MetreSecToKmHConverter}}"
					Foreground="{StaticResource ObjectInOverlayForegroundBrush}"
					Style="{StaticResource HugeTextStyle}"/>
			</StackPanel>
		</Canvas>
		<!--scale-->
		<Grid Height="Auto" Canvas.ZIndex="200" VerticalAlignment="Bottom" Margin="0" Padding="0">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="28"/>
			</Grid.RowDefinitions>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="{StaticResource GridSize4Placeholder_Medium}"/>
				<ColumnDefinition />
			</Grid.ColumnDefinitions>
			<!-- left distance -->
			<TextBlock Grid.Row="1" Grid.Column="1"
				Text="0"
				FontWeight="Bold" 
				Style="{StaticResource BaseMessageStyle}" Padding="0"
				Foreground="{StaticResource ObjectInOverlayForegroundBrush}" ScrollViewer.VerticalScrollBarVisibility="Disabled"/>
			<!-- right distance -->
			<Grid Grid.Row="1" Grid.Column="1"
				Width="{Binding ElementName=MyMap, Path=ZoomLevel, Converter={StaticResource ScaleSizeConverter}, ConverterParameter=rightLabelX}">
				<TextBlock Text="{Binding ElementName=MyMap, Path=ZoomLevel, Converter={StaticResource ScaleSizeConverter}, ConverterParameter=distRounded}"
				   HorizontalAlignment="Right"
				   FontWeight="Bold" 
				   Style="{StaticResource BaseMessageStyle}" Padding="0"
				   Foreground="{StaticResource ObjectInOverlayForegroundBrush}" ScrollViewer.VerticalScrollBarVisibility="Disabled"/>
			</Grid>
			<!-- internal zoom level -->
			<TextBlock Grid.Row="0" Grid.Column="1"
				Text="{Binding ElementName=MyMap, Path=ZoomLevel, Converter={StaticResource ScaleSizeConverter}, ConverterParameter=techZoom}"
				FontWeight="Bold" 
				Style="{StaticResource BaseMessageStyle}" Padding="0"
				Foreground="{StaticResource ObjectInOverlayForegroundBrush}" ScrollViewer.VerticalScrollBarVisibility="Disabled" />
			<!-- scale bar -->
			<Image x:Name="ScaleImage" Grid.Row="2" Grid.Column="1"
				Source="ms-appx:///Assets/scale-300.png" 
				Stretch="None"
				RenderTransformOrigin="0.0,0.0" >
				<Image.RenderTransform>
					<CompositeTransform ScaleX="{Binding ElementName=MyMap, Path=ZoomLevel, Converter={StaticResource ScaleSizeConverter}, ConverterParameter=imageScaleTransform}"/>
				</Image.RenderTransform>
			</Image>
		</Grid>
		<!--aim centre-->
		<Image Canvas.ZIndex="200" 
			Source="ms-appx:///Assets/aim-120.png"
			Stretch="None"
			VerticalAlignment="Center" HorizontalAlignment="Center"
			Visibility="{Binding IsShowAim, Converter={StaticResource BooleanToVisibleConverter}}"
			Tapped="OnAim_Tapped"
			Holding="OnAim_Holding"
			IsDoubleTapEnabled="False" IsRightTapEnabled="False"/>
		<!-- tile source -->
		<Border Canvas.ZIndex="300"
				HorizontalAlignment="Right" VerticalAlignment="Top"
				Background="{ThemeResource SystemChromeBlackHighColor}"
				RenderTransformOrigin="1, 1"
				Visibility="{Binding CurrentTileSource, Converter={StaticResource TileSourceToVisibleConverter}}"
				Tapped="OnProvider_Tapped">
			<Border.RenderTransform>
				<RotateTransform Angle="-90"/>
			</Border.RenderTransform>
			<StackPanel Orientation="Horizontal" >
				<TextBlock Text="© "
					Style="{StaticResource BaseMessageStyle}"
					Foreground="{ThemeResource SystemControlForegroundChromeWhiteBrush}"
					Margin="6,2,6,2"/>
				<TextBlock Text="{Binding CurrentTileSource, Converter={StaticResource MapSourceToItsDescriptionConverter}}"
					Style="{StaticResource BaseMessageStyle}"
					Foreground="{ThemeResource SystemControlForegroundChromeWhiteBrush}"
					Margin="6,2,6,2"/>
			</StackPanel>
		</Border>
		<!--MapControl-->
		<!--CenterChanged="OnMyMap_CenterChanged" HeadingChanged="OnMyMap_HeadingChanged" PitchChanged="OnMyMap_PitchChanged" ZoomLevelChanged="OnMyMap_ZoomLevelChanged"-->
		<Maps:MapControl Canvas.ZIndex="100"
			x:Name="MyMap"
			HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
			VerticalAlignment="Stretch" VerticalContentAlignment="Stretch"
			MapTapped="OnMap_Tapped" MapHolding="OnMap_Holding"
			IsHoldingEnabled="True" IsDoubleTapEnabled="False" IsRightTapEnabled="False">
			<!--<Maps:MapItemsControl x:Name="LandmarksMIC"
				ItemTemplate="{StaticResource LandmarksTemplate}"
				ItemsSource="{Binding ElementName=me, Path=LandmarkLocations}"/>-->
		</Maps:MapControl>
	</Grid>
</ctl:OpObsOrControl>
